<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>íœ˜ìŠ¬ STAT ê´€ë¦¬</title>
  <!-- (ê¸°ì¡´ ìŠ¤íƒ€ì¼ ì „ì²´ ìœ ì§€ - ìƒëµ ê°€ëŠ¥) -->
  <style>
    /* ğŸ’¡ ê¸°ì¡´ CSSëŠ” ë™ì¼í•˜ë¯€ë¡œ ìƒëµí•©ë‹ˆë‹¤. */
  </style>
</head>
<body>
  <div class="container">
    <!-- ... ìƒë‹¨ êµ¬ì„± ë™ì¼ ... -->
    <!-- ê²½ê¸° ìˆ˜, ìŠ¹ë¥ , ë“ì , ë“ì‹¤ì°¨ëŠ” ê³ ì • ìˆ˜ì¹˜ê°€ ì•„ë‹Œ JSì—ì„œ ê³„ì‚°í•˜ë„ë¡ í•  ìˆ˜ë„ ìˆìŒ -->
    
    <!-- ì„ ìˆ˜ë³„ í†µê³„ / ê²½ê¸° ê²°ê³¼ ì˜ì—­ -->
    <div class="main-content">
      <div class="section">
        <div class="section-title">ì„ ìˆ˜ë³„ í†µê³„</div>
        <div class="filter-controls">
          <button class="filter-btn active" onclick="filterPlayers('all')">ì „ì²´</button>
          <button class="filter-btn" onclick="filterPlayers('goals')">ê³¨ ìˆœ</button>
          <button class="filter-btn" onclick="filterPlayers('attendance')">ì°¸ì„ë¥  ìˆœ</button>
          <button class="filter-btn" onclick="filterPlayers('mvp')">MVP íšŸìˆ˜</button>
        </div>
        <div class="table-container">
          <table class="players-table">
            <thead>
              <tr>
                <th>ì´ë¦„</th>
                <th>ì¶œì „</th>
                <th>ì°¸ì„ë¥ </th>
                <th>ê³¨</th>
                <th>MVP</th>
              </tr>
            </thead>
            <tbody id="playersTableBody"></tbody>
          </table>
        </div>
      </div>

      <div class="section">
        <div class="section-title">ìµœê·¼ ê²½ê¸° ê²°ê³¼</div>
        <div class="table-container">
          <table class="matches-table">
            <thead>
              <tr>
                <th>ë‚ ì§œ</th>
                <th>ìƒëŒ€</th>
                <th>ê²°ê³¼</th>
                <th>ìŠ¤ì½”ì–´</th>
                <th>MVP</th>
              </tr>
            </thead>
            <tbody id="matchesTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ë‹¤ìŒ ê²½ê¸° ì¼ì • ë° ì§€ë„ ì„¹ì…˜ ë™ì¼ -->
  </div>

  <!-- ìŠ¤í¬ë¦½íŠ¸ ì˜ì—­ -->
  <script>
    let matches = [];
    let playerStats = {};
    let currentFilter = 'all';

    function updatePlayersTable() {
      const tbody = document.getElementById('playersTableBody');
      tbody.innerHTML = '';

      let playersArray = Object.entries(playerStats).map(([name, stats]) => ({
        name,
        ...stats,
        attendanceRate: ((stats.appearances / matches.length) * 100).toFixed(1)
      }));

      switch (currentFilter) {
        case 'goals':
          playersArray.sort((a, b) => b.goals - a.goals);
          break;
        case 'attendance':
          playersArray.sort((a, b) => b.attendanceRate - a.attendanceRate);
          break;
        case 'mvp':
          playersArray.sort((a, b) => b.mvp - a.mvp);
          break;
        default:
          playersArray.sort((a, b) => a.name.localeCompare(b.name));
      }

      playersArray.forEach(player => {
        let rateClass = 'rate-low';
        if (player.attendanceRate >= 70) rateClass = 'rate-high';
        else if (player.attendanceRate >= 50) rateClass = 'rate-medium';

        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${player.name}</td>
          <td>${player.appearances}</td>
          <td><span class="attendance-rate ${rateClass}">${player.attendanceRate}%</span></td>
          <td>${player.goals}</td>
          <td>${player.mvp > 0 ? `<span class="mvp-badge">${player.mvp}íšŒ</span>` : '0'}</td>
        `;
        tbody.appendChild(row);
      });
    }

    function updateMatchesTable() {
      const tbody = document.getElementById('matchesTableBody');
      tbody.innerHTML = '';

      matches.slice(0, 15).forEach(match => {
        let resultClass = 'result-loss';
        let resultText = 'íŒ¨';
        if (match.result === 'win') {
          resultClass = 'result-win';
          resultText = 'ìŠ¹';
        } else if (match.result === 'draw') {
          resultClass = 'result-draw';
          resultText = 'ë¬´';
        }

        const row = document.createElement('tr');
        row.innerHTML = `
          <td style="white-space: nowrap;">${match.date}</td>
          <td>${match.opponent}</td>
          <td><span class="result-badge ${resultClass}">${resultText}</span></td>
          <td>${match.score}</td>
          <td>${match.mvp ? `<span class="mvp-badge">${match.mvp}</span>` : ''}</td>
        `;
        tbody.appendChild(row);
      });
    }

    function filterPlayers(filter) {
      currentFilter = filter;
      document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      updatePlayersTable();
    }

    async function loadData() {
      try {
        const response = await fetch('match_data.json');
        const data = await response.json();
        matches = data.matches;
        playerStats = data.players;

        updatePlayersTable();
        updateMatchesTable();
      } catch (error) {
        console.error('âš ï¸ ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', error);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadData();
      setTimeout(loadKakaoMap, 3000); // ê¸°ì¡´ ì§€ë„ ë¡œë”©
    });

    function loadKakaoMap() {
      const script = document.createElement('script');
      script.src = 'https://dapi.kakao.com/v2/maps/sdk.js?appkey=47eed652b004605d8a8e3e39df268f24&autoload=false&libraries=services';
      script.onload = () => {
        kakao.maps.load(() => {
          const mapContainer = document.getElementById('map-placeholder');
          mapContainer.innerHTML = '<div id="map" style="width:100%;height:300px;border-radius:8px;border:2px solid #1e40af;"></div>';

          const map = new kakao.maps.Map(document.getElementById('map'), {
            center: new kakao.maps.LatLng(37.4656, 127.0347),
            level: 3
          });

          const geocoder = new kakao.maps.services.Geocoder();
          const address = 'ì„œìš¸íŠ¹ë³„ì‹œ êµ¬ë¡œêµ¬ ê³ ì²™ë¡œ45ê¸¸ 37';

          geocoder.addressSearch(address, (result, status) => {
            if (status === kakao.maps.services.Status.OK) {
              const coords = new kakao.maps.LatLng(result[0].y, result[0].x);
              map.setCenter(coords);
              const marker = new kakao.maps.Marker({ map, position: coords });
              const infowindow = new kakao.maps.InfoWindow({
                content: '<div style="padding:5px;font-size:12px;text-align:center;">ê³ ì²™ê·¼ë¦°ê³µì› ì¶•êµ¬ì¥</div>'
              });
              infowindow.open(map, marker);
            } else {
              document.getElementById('map').innerHTML = `<div style="text-align:center;color:#666;">ì£¼ì†Œ ê²€ìƒ‰ ì‹¤íŒ¨: ${status}</div>`;
            }
          });
        });
      };
      script.onerror = () => {
        console.error('ì¹´ì¹´ì˜¤ë§µ ë¡œë“œ ì‹¤íŒ¨');
        document.getElementById('map-placeholder').innerHTML = `<div>ì§€ë„ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>`;
      };
      document.head.appendChild(script);
    }
  </script>
</body>
</html>
