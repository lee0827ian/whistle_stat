<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íœ˜ìŠ¬ STAT ê´€ë¦¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(90deg, #1e3a8a, #3b82f6, #60a5fa, #fbbf24, #f59e0b);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #1e40af;
        }

        .team-name {
            font-size: 2.5em;
            color: #1e40af;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .season-selector {
            margin-bottom: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
        }

        .season-selector select {
            padding: 12px 20px;
            border: 3px solid #1e40af;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            color: #1e40af;
            background: linear-gradient(135deg, #ffffff, #f8fafc);
            cursor: pointer;
            min-width: 160px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(30, 64, 175, 0.15);
            transition: all 0.3s ease;
            outline: none;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4 5"><path fill="%231e40af" d="M2 0L0 2h4zm0 5L0 3h4z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 12px;
            padding-right: 45px;
        }

        .season-selector select:hover {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            box-shadow: 0 6px 20px rgba(30, 64, 175, 0.25);
            transform: translateY(-2px);
        }

        .season-selector select:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.15);
        }

        .all-time-button {
            padding: 12px 24px;
            border: 3px solid #f59e0b;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            color: #f59e0b;
            background: linear-gradient(135deg, #ffffff, #fefbf1);
            cursor: pointer;
            min-width: 120px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.15);
            transition: all 0.3s ease;
            outline: none;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .all-time-button:hover {
            background: linear-gradient(135deg, #fefbf1, #fef3c7);
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.25);
            transform: translateY(-2px);
        }

        .all-time-button.active {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            border-color: #d97706;
        }

        .all-time-button.active:hover {
            background: linear-gradient(135deg, #d97706, #b45309);
        }

        .status-message {
            margin: 15px 0;
            padding: 12px 20px;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
            display: none;
        }

        .status-loading {
            background: #eff6ff;
            color: #1e40af;
            border: 2px solid #dbeafe;
        }

        .status-error {
            background: #fef2f2;
            color: #dc2626;
            border: 2px solid #fecaca;
        }

        .status-success {
            background: #f0fdf4;
            color: #16a34a;
            border: 2px solid #bbf7d0;
        }

        .season {
            display: none;
        }

        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: linear-gradient(135deg, #1e40af, #60a5fa);
            padding: 25px;
            border-radius: 15px;
            color: white;
            text-align: center;
        }

        .stat-title {
            font-size: 1.2em;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-subtitle {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .all-time-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            height: 580px;
            display: flex;
            flex-direction: column;
        }

        .all-time-view .section {
            height: 750px;
        }

        .team-records-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            height: 580px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .all-time-view .team-records-section {
            height: 750px;
        }

        .section-title {
            font-size: 1.5em;
            color: #1e40af;
            margin-bottom: 20px;
            font-weight: bold;
            text-align: center;
        }

        .players-table, .matches-table, .regional-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .players-table th, .players-table td, 
        .matches-table th, .matches-table td,
        .regional-table th, .regional-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            font-size: 0.9em;
        }

        .players-table th, .matches-table th, .regional-table th {
            background: #1e40af;
            color: white;
            font-weight: bold;
            position: sticky;
            top: 0;
            cursor: pointer;
            transition: background 0.3s;
        }

        .players-table th:hover, .matches-table th:hover, .regional-table th:hover {
            background: #1d4ed8;
        }

        .players-table tr:hover, .matches-table tr:hover, .regional-table tr:hover {
            background: #f5f5f5;
        }

        .attendance-rate {
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: bold;
            color: white;
            font-size: 0.8em;
        }

        .rate-high {
            background: #1e40af;
        }

        .rate-medium {
            background: #fbbf24;
            color: #333;
        }

        .rate-low {
            background: #dc3545;
        }

        .mvp-badge {
            background: #fbbf24;
            color: #333;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.7em;
            font-weight: bold;
            white-space: nowrap;
            display: inline-block;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .season-mvp-badge {
            background: #fbbf24;
            color: #333;
            padding: 4px 12px;
            border-radius: 8px;
            font-size: 1.2em;
            font-weight: bold;
            display: inline-block;
            margin-top: 5px;
        }

        .result-badge {
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: bold;
            color: white;
            font-size: 0.8em;
        }

        .result-win {
            background: #1e40af;
        }

        .result-draw {
            background: #fbbf24;
            color: #333;
        }

        .result-loss {
            background: #dc3545;
        }

        .table-container {
            flex: 1;
            overflow-y: auto;
            border-radius: 8px;
            border: 1px solid #ddd;
            max-height: 410px; 
        }

        .team-record-card {
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            min-height: 120px;
        }

        .team-record-overall {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: #1e293b;
            min-height: 140px;
        }

        .team-record-win-streak {
            background: linear-gradient(135deg, #10b981, #34d399);
            color: white;
        }

        .team-record-loss-streak {
            background: linear-gradient(135deg, #f43f5e, #fb7185);
            color: white;
        }

        .team-record-max-goals {
            background: linear-gradient(135deg, #06b6d4, #22d3ee);
            color: white;
        }

        .team-record-max-conceded {
            background: linear-gradient(135deg, #ef4444, #f87171);
            color: white;
        }

        .team-record-best-season {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: #1e293b;
        }

        .team-record-worst-season {
            background: linear-gradient(135deg, #6b7280, #9ca3af);
            color: white;
        }

        .team-record-title {
            font-size: 1.0em;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .team-record-value {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 6px;
        }

        .team-record-detail {
            font-size: 0.85em;
            opacity: 0.9;
        }

        .regional-records-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-top: 30px;
            grid-column: 1 / -1;
            height: 580px;
            display: flex;
            flex-direction: column;
        }

        .all-time-view .regional-records-section {
            height: 750px;
        }

        .winrate-cell {
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: bold;
            color: white;
            font-size: 0.8em;
            text-align: center;
        }

        .winrate-excellent {
            background: #10b981;
        }

        .winrate-good {
            background: #3b82f6;
        }

        .winrate-average {
            background: #fbbf24;
            color: #1e293b;
        }

        .winrate-poor {
            background: #ef4444;
        }

        .next-matches-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-top: 60px;
            border-top: 2px solid #e9ecef;
        }

        .all-time-view .next-matches-section {
            display: none;
        }

        .schedule-and-map {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }

        .schedule-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .schedule-item {
            background: linear-gradient(135deg, #1e40af, #60a5fa);
            color: white;
            border-radius: 12px;
            padding: 20px;
            margin: 10px 0;
            text-align: center;
        }

        .schedule-date {
            font-weight: bold;
            font-size: 1.3em;
            margin-bottom: 8px;
        }

        .schedule-time-venue {
            font-size: 1.1em;
            margin-bottom: 12px;
            opacity: 0.95;
        }

        .schedule-opponent {
            font-size: 1.4em;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .map-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
        }

        #map {
            width: 100%;
            height: 300px;
            border-radius: 8px;
            border: 2px solid #1e40af;
        }

        .map-placeholder {
            width: 100%;
            height: 300px;
            background: #e9ecef;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #1e40af;
            font-size: 1.1em;
            border: 2px dashed #1e40af;
            flex-direction: column;
        }

        .venue-info {
            margin-top: 15px;
            text-align: left;
        }

        .venue-name {
            font-weight: bold;
            color: #1e40af;
            font-size: 1.2em;
            margin-bottom: 5px;
        }

        .venue-address {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .venue-phone {
            color: #666;
            font-size: 0.9em;
        }

        .filter-controls {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 15px;
            border: 2px solid #1e40af;
            background: white;
            color: #1e40af;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .filter-btn.active {
            background: #1e40af;
            color: white;
        }

        .no-data {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
        }

        .all-time-highlight {
            background: linear-gradient(135deg, #fbbf24, #f59e0b) !important;
        }

        .rank-medal {
            font-size: 1.2em;
            margin-left: 5px;
        }

        .loading-progress {
            margin: 10px 0;
            height: 4px;
            background: #e2e8f0;
            border-radius: 2px;
            overflow: hidden;
            display: none;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #1e40af, #3b82f6);
            transition: width 0.3s ease;
            width: 0%;
        }

        .loading-stats {
            font-size: 0.9em;
            color: #666;
            text-align: center;
            margin-top: 5px;
        }

        .sort-indicator {
            display: inline-block;
            margin-left: 5px;
            font-size: 0.8em;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .season-selector {
                flex-direction: column;
                gap: 10px;
            }

            .season-selector select, .all-time-button {
                min-width: 140px;
                font-size: 1em;
                padding: 10px 15px;
            }

            .main-content, .all-time-content {
                grid-template-columns: 1fr;
            }

            .schedule-and-map {
                grid-template-columns: 1fr;
            }

            .stats-overview {
                grid-template-columns: repeat(2, 1fr);
            }

            .team-name {
                font-size: 2em;
            }

            .table-container {
                max-height: 350px;
            }

            .players-table th, .players-table td, 
            .matches-table th, .matches-table td,
            .regional-table th, .regional-table td {
                padding: 6px 4px;
                font-size: 0.75em;
            }

            .mvp-badge {
                font-size: 0.65em;
                padding: 1px 4px;
                max-width: 60px;
            }

            .players-table th:nth-child(1), .players-table td:nth-child(1) {
                width: 20%;
            }

            .players-table th:nth-child(2), .players-table td:nth-child(2) {
                width: 15%;
            }

            .players-table th:nth-child(3), .players-table td:nth-child(3) {
                width: 20%;
            }

            .players-table th:nth-child(4), .players-table td:nth-child(4) {
                width: 15%;
            }

            .players-table th:nth-child(5), .players-table td:nth-child(5) {
                width: 30%;
            }

            .matches-table th:nth-child(1), .matches-table td:nth-child(1) {
                width: 18%;
                white-space: nowrap;
                font-size: 0.7em;
            }

            .matches-table th:nth-child(2), .matches-table td:nth-child(2) {
                width: 22%;
            }

            .matches-table th:nth-child(3), .matches-table td:nth-child(3) {
                width: 12%;
            }

            .matches-table th:nth-child(4), .matches-table td:nth-child(4) {
                width: 18%;
            }

            .matches-table th:nth-child(5), .matches-table td:nth-child(5) {
                width: 30%;
            }

            .regional-table th:nth-child(1), .regional-table td:nth-child(1) {
                width: 25%;
            }

            .regional-table th:nth-child(2), .regional-table td:nth-child(2) {
                width: 15%;
            }

            .regional-table th:nth-child(3), .regional-table td:nth-child(3) {
                width: 12%;
            }

            .regional-table th:nth-child(4), .regional-table td:nth-child(4) {
                width: 12%;
            }

            .regional-table th:nth-child(5), .regional-table td:nth-child(5) {
                width: 12%;
            }

            .regional-table th:nth-child(6), .regional-table td:nth-child(6) {
                width: 24%;
            }

            .section, .team-records-section, .regional-records-section {
                height: auto;
                padding: 15px;
            }

            .next-matches-section {
                margin-top: 40px;
                padding: 15px;
            }

            .schedule-item {
                padding: 15px;
                margin: 15px 0;
            }

            .schedule-date {
                font-size: 1.2em;
            }

            .schedule-time-venue {
                font-size: 1em;
            }

            .schedule-opponent {
                font-size: 1.3em;
            }

            .filter-controls {
                gap: 5px;
            }

            .filter-btn {
                padding: 6px 12px;
                font-size: 0.8em;
            }

            #map, .map-placeholder {
                height: 250px;
            }
        }

        @media (max-width: 480px) {
            .stats-overview {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .stat-card {
                padding: 20px;
            }

            .schedule-item {
                padding: 12px;
            }

            .schedule-date {
                font-size: 1.1em;
            }

            .schedule-opponent {
                font-size: 1.2em;
            }

            .season-selector select, .all-time-button {
                min-width: 120px;
                font-size: 0.9em;
                padding: 8px 12px;
            }

            .players-table th, .players-table td, 
            .matches-table th, .matches-table td,
            .regional-table th, .regional-table td {
                padding: 4px 2px;
                font-size: 0.7em;
            }

            .mvp-badge {
                font-size: 0.6em;
                padding: 1px 3px;
                max-width: 50px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="team-name">WHISTLE</div>
            <div class="season-selector">
                <select id="seasonSelect" onchange="changeSeason()" onclick="onSeasonSelectClick()">
                    <option value="2025">ğŸ† 2025 ì‹œì¦Œ</option>
                    <option value="2024">2024 ì‹œì¦Œ</option>
                    <option value="2023">2023 ì‹œì¦Œ</option>
                    <option value="2022">2022 ì‹œì¦Œ</option>
                    <option value="2021">2021 ì‹œì¦Œ</option>
                    <option value="2020">2020 ì‹œì¦Œ</option>
                    <option value="2019">2019 ì‹œì¦Œ</option>
                    <option value="2018">2018 ì‹œì¦Œ</option>
                    <option value="2017">2017 ì‹œì¦Œ</option>
                    <option value="2016">2016 ì‹œì¦Œ</option>
                    <option value="2015">2015 ì‹œì¦Œ</option>
                    <option value="2014">2014 ì‹œì¦Œ</option>
                    <option value="2013">2013 ì‹œì¦Œ</option>
                    <option value="2012">2012 ì‹œì¦Œ</option>
                    <option value="2011">2011 ì‹œì¦Œ</option>
                    <option value="2010">2010 ì‹œì¦Œ</option>
                    <option value="2009">2009 ì‹œì¦Œ</option>
                    <option value="2008">2008 ì‹œì¦Œ</option>
                    <option value="2007">2007 ì‹œì¦Œ</option>
                    <option value="2006">2006 ì‹œì¦Œ</option>
                    <option value="2005">2005 ì‹œì¦Œ</option>
                    <option value="2004">2004 ì‹œì¦Œ</option>
                    <option value="2003">2003 ì‹œì¦Œ</option>
                    <option value="2002">2002 ì‹œì¦Œ</option>
                    <option value="2001">2001 ì‹œì¦Œ</option>
                    <option value="2000">2000 ì‹œì¦Œ</option>
                </select>
                <button id="allTimeButton" class="all-time-button" onclick="toggleAllTimeView()">
                    ğŸ“Š ì—­ëŒ€ ê¸°ë¡
                </button>
            </div>
            <div id="statusMessage" class="status-message"></div>
            <div id="loadingProgress" class="loading-progress">
                <div id="loadingProgressBar" class="loading-progress-bar"></div>
            </div>
            <div id="loadingStats" class="loading-stats"></div>
        </div>

        <div class="stats-overview">
            <div class="stat-card">
                <div class="stat-title">ê²½ê¸° ìˆ˜</div>
                <div class="stat-value" id="totalMatches">0</div>
                <div class="stat-subtitle">ì´ ê²½ê¸°</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">ìŠ¹ë¥ </div>
                <div class="stat-value" id="winRate">0%</div>
                <div class="stat-subtitle" id="winRateSubtitle">0ìŠ¹ 0ë¬´ 0íŒ¨</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">ë“ì </div>
                <div class="stat-value" id="totalGoals">0</div>
                <div class="stat-subtitle" id="goalsPerMatch">ê²½ê¸°ë‹¹ 0ê³¨</div>
            </div>
            <div class="stat-card">
                <div class="stat-title" id="mvpCardTitle">ì‹œì¦Œ MVP</div>
                <div class="stat-value" id="seasonMvp">-</div>
                <div class="stat-subtitle" id="mvpStats">MVP 0íšŒ</div>
            </div>
        </div>

        <div id="mainContent" class="main-content">
            <div class="section" id="matchesSection">
                <div class="section-title">ìµœê·¼ ê²½ê¸° ê²°ê³¼</div>
                <div class="table-container">
                    <table class="matches-table">
                        <thead>
                            <tr>
                                <th>ë‚ ì§œ</th>
                                <th>ìƒëŒ€</th>
                                <th>ê²°ê³¼</th>
                                <th>ìŠ¤ì½”ì–´</th>
                                <th>MVP</th>
                            </tr>
                        </thead>
                        <tbody id="matchesTableBody">
                            <tr><td colspan="5" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="section">
                <div class="section-title">ì„ ìˆ˜ë³„ í†µê³„</div>
                <div class="filter-controls">
                    <button class="filter-btn active" data-filter="all" onclick="filterPlayers('all')">ì „ì²´</button>
                    <button class="filter-btn" data-filter="goals" onclick="filterPlayers('goals')">ê³¨ ìˆœ</button>
                    <button class="filter-btn" data-filter="attendance" onclick="filterPlayers('attendance')">ì°¸ì„ ìˆœ</button>
                    <button class="filter-btn" data-filter="mvp" onclick="filterPlayers('mvp')">MVP íšŸìˆ˜</button>
                </div>
                <div class="table-container">
                    <table class="players-table">
                        <thead>
                            <tr id="playersTableHeader">
                                <th>ì´ë¦„</th>
                                <th>ì¶œì „</th>
                                <th>ì°¸ì„ë¥ </th>
                                <th>ê³¨</th>
                                <th>MVP</th>
                            </tr>
                        </thead>
                        <tbody id="playersTableBody">
                            <tr><td colspan="5" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="allTimeContent" class="all-time-content" style="display: none;">
            <div class="section">
                <div class="section-title">ì—­ëŒ€ ì„ ìˆ˜ ê¸°ë¡</div>
                <div class="filter-controls">
                    <button class="filter-btn active" data-filter="all" onclick="filterPlayers('all')">ì „ì²´</button>
                    <button class="filter-btn" data-filter="goals" onclick="filterPlayers('goals')">ê³¨ ìˆœ</button>
                    <button class="filter-btn" data-filter="attendance" onclick="filterPlayers('attendance')">ì°¸ì„ ìˆœ</button>
                    <button class="filter-btn" data-filter="mvp" onclick="filterPlayers('mvp')">MVP íšŸìˆ˜</button>
                </div>
                <div class="table-container">
                    <table class="players-table">
                        <thead>
                            <tr id="allTimePlayersTableHeader">
                                <th>ì´ë¦„</th>
                                <th>ì´ ì¶œì¥</th>
                                <th>ì´ ë“ì </th>
                                <th>ì´ MVP</th>
                            </tr>
                        </thead>
                        <tbody id="allTimePlayersTableBody">
                            <tr><td colspan="4" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="team-records-section">
                <div class="section-title">ì—­ëŒ€ íŒ€ ê¸°ë¡</div>
                <div id="teamRecordsContainer">
                </div>
            </div>

            <div class="regional-records-section">
                <div class="section-title">ğŸ—ºï¸ ì§€ì—­ë³„ ê²½ê¸° ê¸°ë¡</div>
                <div class="filter-controls">
                    <button class="filter-btn" data-filter="matches" onclick="filterRegional('matches')">ê²½ê¸°ìˆ˜ ìˆœ</button>
                    <button class="filter-btn active" data-filter="winrate" onclick="filterRegional('winrate')">ìŠ¹ë¥  ìˆœ</button>
                    <button class="filter-btn" data-filter="wins" onclick="filterRegional('wins')">ìŠ¹ìˆ˜ ìˆœ</button>
                    <button class="filter-btn" data-filter="name" onclick="filterRegional('name')">ì§€ì—­ëª… ìˆœ</button>
                </div>
                <div class="table-container">
                    <table class="regional-table">
                        <thead>
                            <tr>
                                <th onclick="filterRegional('name')">ì§€ì—­ <span class="sort-indicator" id="regionNameSort"></span></th>
                                <th onclick="filterRegional('matches')">ê²½ê¸°ìˆ˜ <span class="sort-indicator" id="regionMatchesSort"></span></th>
                                <th onclick="filterRegional('wins')">ìŠ¹ <span class="sort-indicator" id="regionWinsSort"></span></th>
                                <th onclick="filterRegional('draws')">ë¬´ <span class="sort-indicator" id="regionDrawsSort"></span></th>
                                <th onclick="filterRegional('losses')">íŒ¨ <span class="sort-indicator" id="regionLossesSort"></span></th>
                                <th onclick="filterRegional('winrate')">ìŠ¹ë¥  <span class="sort-indicator" id="regionWinrateSort">â†“</span></th>
                            </tr>
                        </thead>
                        <tbody id="regionalTableBody">
                            <tr><td colspan="6" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="next-matches-section">
            <div class="section-title">ë‹¤ìŒ ê²½ê¸° ì¼ì • ë° êµ¬ì¥ ìœ„ì¹˜</div>
            <div class="schedule-and-map">
                <div class="schedule-container">
                    <h3 style="color: #1e40af; margin-bottom: 15px;">ë‹¤ìŒ ê²½ê¸° ì¼ì •</h3>
                </div>
                <div class="map-container">
                    <h3 style="color: #1e40af; margin-bottom: 15px;">êµ¬ì¥ìœ„ì¹˜</h3>
                    <div id="map-placeholder" class="map-placeholder">
                        ğŸ—ºï¸<br>ê°ì¼ì¶•êµ¬ì¥<br>
                        <small>ì§€ë„ ë¡œë”© ì¤‘...</small>
                    </div>
                    <div class="venue-info">
                        <div class="venue-name">ê°ì¼ì¶•êµ¬ì¥</div>
                        <div class="venue-address">ğŸ“ ê²½ê¸° í•˜ë‚¨ì‹œ ê°ì´ë™ 465</div>
                        <div class="venue-phone">ğŸ“ ì „í™”ë²ˆí˜¸: 031-790-2022, ì£¼ì°¨ í¸í•¨</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const CONFIG = {
            AVAILABLE_SEASONS: ['2000','2001','2002','2003','2004','2005','2006','2007','2008','2009','2010','2011','2012','2013','2014','2015','2016','2017','2018','2019', '2020', '2021', '2022', '2023', '2024', '2025'],
            DEFAULT_SEASON: '2025',
            KAKAO_MAP_API_KEY: '47eed652b004605d8a8e3e39df268f24',
            VENUE: { name: 'ê°ì¼ì¶•êµ¬ì¥', address: 'ê²½ê¸° í•˜ë‚¨ì‹œ ê°ì´ë™ 465', info: 'ì „í™”ë²ˆí˜¸: 031-790-2022, ì£¼ì°¨ í¸í•¨' },
            PARALLEL_LOADING: { BATCH_SIZE: 5, MAX_CONCURRENT: 3 }
        };

        const GOOGLE_SHEETS_CONFIG = {
            SHEET_ID: '13UOlG3FdqufeoW2uV3x7L4KFMOo9YrwrjkrExXSVGIg',
            SEASONS: {
                '2025': { matches: '1013896035', players: '882762798', schedule: '1750685299', regional: '1050217492' }
            }
        };

        let currentSeason = CONFIG.DEFAULT_SEASON;
        let isAllTimeView = false;
        let matches = [];
        let playerStats = {};
        let regionalStats = [];
        let currentFilter = 'all';
        let currentRegionalFilter = 'winrate';
        let mapScriptLoaded = false;
        let mapInitialized = false;
        let currentAbortController = null;
        const koreanCollator = new Intl.Collator('ko', { numeric: true });
        const seasonDataCache = new Map();

        function escapeHtml(unsafe) {
            return unsafe.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
        }

        function sanitizeTableData(data) {
            return typeof data === 'string' ? escapeHtml(data) : data;
        }

        function parseCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            const data = [];
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim());
                if (values[0] && !values[0].includes('ğŸ”½') && !values[0].includes('ìƒˆ') && !values[0].includes('ì˜ˆì‹œ:')) {
                    const row = {};
                    headers.forEach((header, index) => { row[header] = values[index] || ''; });
                    data.push(row);
                }
            }
            return data;
        }

        async function loadFromGoogleSheets(season) {
            const seasonConfig = GOOGLE_SHEETS_CONFIG.SEASONS[season];
            if (!seasonConfig) throw new Error(`${season}ë…„ êµ¬ê¸€ ì‹œíŠ¸ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`);
            try {
                const matchesUrl = `https://docs.google.com/spreadsheets/d/${GOOGLE_SHEETS_CONFIG.SHEET_ID}/export?format=csv&gid=${seasonConfig.matches}`;
                const matchesResponse = await fetch(matchesUrl);
                if (!matchesResponse.ok) throw new Error('ê²½ê¸° ê²°ê³¼ ì‹œíŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                const matchesCsv = await matchesResponse.text();
                const matchesData = parseCSV(matchesCsv);

                const playersUrl = `https://docs.google.com/spreadsheets/d/${GOOGLE_SHEETS_CONFIG.SHEET_ID}/export?format=csv&gid=${seasonConfig.players}`;
                const playersResponse = await fetch(playersUrl);
                if (!playersResponse.ok) throw new Error('ì„ ìˆ˜ í†µê³„ ì‹œíŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                const playersCsv = await playersResponse.text();
                const playersData = parseCSV(playersCsv);

                const scheduleUrl = `https://docs.google.com/spreadsheets/d/${GOOGLE_SHEETS_CONFIG.SHEET_ID}/export?format=csv&gid=${seasonConfig.schedule}`;
                const scheduleResponse = await fetch(scheduleUrl);
                if (!scheduleResponse.ok) throw new Error('ë‹¤ìŒ ê²½ê¸° ì¼ì • ì‹œíŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                const scheduleCsv = await scheduleResponse.text();
                const scheduleData = parseCSV(scheduleCsv);

                const regionalUrl = `https://docs.google.com/spreadsheets/d/${GOOGLE_SHEETS_CONFIG.SHEET_ID}/export?format=csv&gid=${seasonConfig.regional}`;
                const regionalResponse = await fetch(regionalUrl);
                if (!regionalResponse.ok) throw new Error('ì§€ì—­ë³„ ê¸°ë¡ ì‹œíŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                const regionalCsv = await regionalResponse.text();
                const regionalData = parseCSV(regionalCsv);

                const matches = matchesData.filter(row => row['ë‚ ì§œ'] && row['ìƒëŒ€íŒ€']).map(row => ({
                    date: row['ë‚ ì§œ'], opponent: row['ìƒëŒ€íŒ€'], result: row['ê²°ê³¼'], score: row['ìŠ¤ì½”ì–´'], mvp: row['MVP'] || ''
                })).sort((a, b) => new Date(b.date) - new Date(a.date));

                const players = {};
                playersData.filter(row => row['ì´ë¦„']).forEach(row => {
                    players[row['ì´ë¦„']] = { appearances: parseInt(row['ì¶œì¥']) || 0, goals: parseInt(row['ê³¨']) || 0, mvp: parseInt(row['MVP']) || 0 };
                });

                const today = new Date();
                const schedules = scheduleData.filter(row => row['ë‚ ì§œ'] && row['ìƒëŒ€íŒ€'] && new Date(row['ë‚ ì§œ']) > today).map(row => ({
                    date: row['ë‚ ì§œ'], time: row['ì‹œê°„'], venue: row['êµ¬ì¥ëª…'], opponent: row['ìƒëŒ€íŒ€'], address: row['êµ¬ì¥ì£¼ì†Œ'], note: row['ë¹„ê³ '] || ''
                })).sort((a, b) => new Date(a.date) - new Date(b.date));

                const regional = regionalData.filter(row => row['ì§€ì—­']).map(row => ({
                    region: row['ì§€ì—­'], matches: parseInt(row['ê²½ê¸°ìˆ˜']) || 0, wins: parseInt(row['ìŠ¹']) || 0, draws: parseInt(row['ë¬´']) || 0, losses: parseInt(row['íŒ¨']) || 0
                }));

                return { season, matches, players, schedules, regional };
            } catch (error) {
                console.error('êµ¬ê¸€ ì‹œíŠ¸ ë¡œë”© ì‹¤íŒ¨:', error);
                throw error;
            }
        }

        function showStatusMessage(message, type = 'loading') {
            const statusElement = document.getElementById('statusMessage');
            statusElement.textContent = message;
            statusElement.className = `status-message status-${type}`;
            statusElement.style.display = 'block';
        }

        function hideStatusMessage() {
            document.getElementById('statusMessage').style.display = 'none';
        }

        function validateSeasonData(data) {
            const validatedData = { matches: [], players: {} };
            if (Array.isArray(data.matches)) {
                validatedData.matches = data.matches.filter(match => match && typeof match.date === 'string' && typeof match.opponent === 'string' && typeof match.result === 'string' && typeof match.score === 'string' && ['win', 'draw', 'loss'].includes(match.result) && /^\d+:\d+$/.test(match.score)).map(match => ({
                    date: sanitizeTableData(match.date), opponent: sanitizeTableData(match.opponent), result: match.result, score: match.score, mvp: sanitizeTableData(match.mvp || '')
                }));
            }
            if (data.players && typeof data.players === 'object') {
                Object.entries(data.players).forEach(([name, stats]) => {
                    if (typeof name === 'string' && stats && typeof stats === 'object') {
                        validatedData.players[sanitizeTableData(name)] = { appearances: Math.max(0, parseInt(stats.appearances) || 0), goals: Math.max(0, parseInt(stats.goals) || 0), mvp: Math.max(0, parseInt(stats.mvp) || 0) };
                    }
                });
            }
            return validatedData;
        }

        function calculateSeasonMvp(playerStats) {
            if (!playerStats || Object.keys(playerStats).length === 0) return null;
            const playersArray = Object.entries(playerStats).map(([name, stats]) => ({ name, ...stats })).filter(player => player.appearances > 0);
            if (playersArray.length === 0) return null;
            playersArray.sort((a, b) => { if (b.mvp !== a.mvp) return b.mvp - a.mvp; if (b.appearances !== a.appearances) return b.appearances - a.appearances; return koreanCollator.compare(a.name, b.name); });
            return playersArray[0];
        }

        function updateButtonStates() {
            const allTimeButton = document.getElementById('allTimeButton');
            const seasonSelect = document.getElementById('seasonSelect');
            const container = document.querySelector('.container');
            if (isAllTimeView) {
                allTimeButton.classList.add('active'); seasonSelect.style.opacity = '0.6'; container.classList.add('all-time-view');
            } else {
                allTimeButton.classList.remove('active'); seasonSelect.style.opacity = '1'; container.classList.remove('all-time-view');
            }
        }

        function onSeasonSelectClick() {
            if (isAllTimeView) { setTimeout(() => { changeSeason(); }, 10); }
        }

        async function loadSeasonDataWithRetry(season, retries = 2) {
            if (seasonDataCache.has(season)) {
                console.log(`ğŸ“¦ ìºì‹œì—ì„œ ${season} ì‹œì¦Œ ë°ì´í„° ë¡œë“œ`);
                return { season, data: seasonDataCache.get(season), success: true };
            }
            let lastError = null;
            for (let i = 0; i <= retries; i++) {
                try {
                    if (season === '2025') {
                        try {
                            const data = await loadFromGoogleSheets(season);
                            seasonDataCache.set(season, data);
                            return { season, data, success: true };
                        } catch (gsError) {
                            console.warn(`êµ¬ê¸€ ì‹œíŠ¸ ë¡œë”© ì‹¤íŒ¨, JSON ì‹œë„: ${gsError.message}`);
                        }
                    }
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 8000);
                    const response = await fetch(`${season}_data.json`, { signal: controller.signal, headers: { 'Cache-Control': 'no-cache', 'Accept': 'application/json' } });
                    clearTimeout(timeoutId);
                    if (!response.ok) throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    const rawData = await response.json();
                    const validatedData = validateSeasonData(rawData);
                    seasonDataCache.set(season, validatedData);
                    return { season, data: validatedData, success: true };
                } catch (error) {
                    lastError = error;
                    if (error.name === 'AbortError') {
                        console.warn(`${season} ë¡œë”© íƒ€ì„ì•„ì›ƒ (ì‹œë„ ${i + 1}/${retries + 1})`);
                    } else {
                        console.warn(`${season} ë¡œë”© ì‹¤íŒ¨ (ì‹œë„ ${i + 1}/${retries + 1}):`, error.message);
                    }
                    if (i < retries) await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));
                }
            }
            return { season, data: null, success: false, error: lastError };
        }

        function updateStats() {
            const statsOverview = document.querySelector('.stats-overview');
            const fragment = document.createDocumentFragment();

            if (matches.length === 0) {
                fragment.innerHTML = `
                    <div class="stat-card"><div class="stat-title">ê²½ê¸° ìˆ˜</div><div class="stat-value">0</div><div class="stat-subtitle">ì´ ê²½ê¸°</div></div>
                    <div class="stat-card"><div class="stat-title">ìŠ¹ë¥ </div><div class="stat-value">0%</div><div class="stat-subtitle">0ìŠ¹ 0ë¬´ 0íŒ¨</div></div>
                    <div class="stat-card"><div class="stat-title">ë“ì </div><div class="stat-value">0</div><div class="stat-subtitle">ê²½ê¸°ë‹¹ 0ê³¨</div></div>
                    <div class="stat-card"><div class="stat-title">ì‹œì¦Œ MVP</div><div class="stat-value">-</div><div class="stat-subtitle">MVP 0íšŒ</div></div>
                `;
            } else {
                const totalMatches = matches.length;
                const wins = matches.filter(m => m.result === 'win').length;
                const draws = matches.filter(m => m.result === 'draw').length;
                const losses = matches.filter(m => m.result === 'loss').length;
                let totalGoalsFor = 0;
                matches.forEach(m => { const [gf] = m.score.split(':').map(Number); if (!isNaN(gf)) totalGoalsFor += gf; });
                const winRate = totalMatches > 0 ? ((wins / totalMatches) * 100).toFixed(1) : 0;
                const goalsPerMatch = totalMatches > 0 ? (totalGoalsFor / totalMatches).toFixed(1) : 0;
                const seasonMvpPlayer = calculateSeasonMvp(playerStats);
                const mvpName = seasonMvpPlayer ? seasonMvpPlayer.name : '-';
                const mvpCount = seasonMvpPlayer ? seasonMvpPlayer.mvp : 0;
                const mvpAppearances = seasonMvpPlayer ? seasonMvpPlayer.appearances : 0;

                fragment.innerHTML = `
                    <div class="stat-card"><div class="stat-title">ê²½ê¸° ìˆ˜</div><div class="stat-value">${totalMatches}</div><div class="stat-subtitle">ì´ ê²½ê¸°</div></div>
                    <div class="stat-card"><div class="stat-title">ìŠ¹ë¥ </div><div class="stat-value">${winRate}%</div><div class="stat-subtitle">${wins}ìŠ¹ ${draws}ë¬´ ${losses}íŒ¨</div></div>
                    <div class="stat-card"><div class="stat-title">ë“ì </div><div class="stat-value">${totalGoalsFor}</div><div class="stat-subtitle">ê²½ê¸°ë‹¹ ${goalsPerMatch}ê³¨</div></div>
                    <div class="stat-card"><div class="stat-title">ì‹œì¦Œ MVP</div><div class="stat-value">${mvpName}</div><div class="stat-subtitle">${mvpCount > 0 ? `MVP ${mvpCount}íšŒ, ${mvpAppearances}ê²½ê¸°` : 'MVP 0íšŒ'}</div></div>
                `;
            }
            statsOverview.innerHTML = '';
            statsOverview.appendChild(fragment);
        }

        function updateTable(data, matchesData, tbodyId, type) {
            const tbody = document.getElementById(tbodyId);
            tbody.innerHTML = '';
            if (type === 'players') {
                if (Object.keys(data).length === 0) { tbody.innerHTML = '<tr><td colspan="5" class="no-data">í•´ë‹¹ ì‹œì¦Œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>'; return; }
                let playersArray = Object.entries(data).map(([name, stats]) => ({ name, ...stats, attendanceRate: matchesData.length > 0 ? ((stats.appearances / matchesData.length) * 100).toFixed(1) : '0.0' }));
                switch (currentFilter) {
                    case 'goals': playersArray.sort((a, b) => { if (b.goals !== a.goals) return b.goals - a.goals; if (b.appearances !== a.appearances) return b.appearances - a.appearances; return koreanCollator.compare(a.name, b.name); }); break;
                    case 'attendance': playersArray.sort((a, b) => { if (b.attendanceRate !== a.attendanceRate) return b.attendanceRate - a.attendanceRate; if (b.goals !== a.goals) return b.goals - a.goals; return koreanCollator.compare(a.name, b.name); }); break;
                    case 'mvp': playersArray.sort((a, b) => { if (b.mvp !== a.mvp) return b.mvp - a.mvp; if (b.appearances !== a.appearances) return b.appearances - a.appearances; return koreanCollator.compare(a.name, b.name); }); break;
                    default: playersArray.sort((a, b) => koreanCollator.compare(a.name, b.name));
                }
                const fragment = document.createDocumentFragment();
                playersArray.forEach(player => {
                    const row = document.createElement('tr');
                    let rateClass = 'rate-low'; if (player.attendanceRate >= 70) rateClass = 'rate-high'; else if (player.attendanceRate >= 50) rateClass = 'rate-medium';
                    row.innerHTML = `<td>${player.name}</td><td>${player.appearances}</td><td><span class="attendance-rate ${rateClass}">${player.attendanceRate}%</span></td><td>${player.goals}</td><td>${player.mvp > 0 ? `<span class="mvp-badge" title="${player.name} ${player.mvp}íšŒ">${player.mvp}íšŒ</span>` : '0'}</td>`;
                    fragment.appendChild(row);
                });
                tbody.appendChild(fragment);
            } else if (type === 'matches') {
                if (matchesData.length === 0) { tbody.innerHTML = '<tr><td colspan="5" class="no-data">í•´ë‹¹ ì‹œì¦Œ ê²½ê¸° ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>'; return; }
                const fragment = document.createDocumentFragment();
                matchesData.forEach(match => {
                    const row = document.createElement('tr');
                    let resultClass = 'result-loss', resultText = 'íŒ¨';
                    if (match.result === 'win') { resultClass = 'result-win'; resultText = 'ìŠ¹'; } else if (match.result === 'draw') { resultClass = 'result-draw'; resultText = 'ë¬´'; }
                    row.innerHTML = `<td style="white-space: nowrap;">${match.date}</td><td>${match.opponent}</td><td><span class="result-badge ${resultClass}">${resultText}</span></td><td>${match.score}</td><td>${match.mvp ? `<span class="mvp-badge" title="${match.mvp}">${match.mvp}</span>` : ''}</td>`;
                    fragment.appendChild(row);
                });
                tbody.appendChild(fragment);
            }
        }

        function updateSchedule(schedules) {
            const scheduleContainer = document.querySelector('.schedule-container');
            const fragment = document.createDocumentFragment();
            const title = document.createElement('h3');
            title.style.color = '#1e40af'; title.style.marginBottom = '15px'; title.textContent = 'ë‹¤ìŒ ê²½ê¸° ì¼ì •';
            fragment.appendChild(title);
            if (!schedules || schedules.length === 0) {
                const noData = document.createElement('div'); noData.className = 'no-data'; noData.textContent = 'ë‹¤ìŒ ê²½ê¸° ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤'; fragment.appendChild(noData);
                const venueInfo = document.querySelector('.venue-info');
                venueInfo.innerHTML = `<div class="venue-name">ê°ì¼ì¶•êµ¬ì¥</div><div class="venue-address">ğŸ“ ê²½ê¸° í•˜ë‚¨ì‹œ ê°ì´ë™ 465</div><div class="venue-phone">ğŸ“ ì „í™”ë²ˆí˜¸: 031-790-2022, ì£¼ì°¨ í¸í•¨</div>`;
                CONFIG.VENUE = { name: 'ê°ì¼ì¶•êµ¬ì¥', address: 'ê²½ê¸° í•˜ë‚¨ì‹œ ê°ì´ë™ 465', info: 'ì „í™”ë²ˆí˜¸: 031-790-2022, ì£¼ì°¨ í¸í•¨' };
                loadKakaoMap();
            } else {
                schedules.forEach(schedule => {
                    const item = document.createElement('div'); item.className = 'schedule-item';
                    item.innerHTML = `<div class="schedule-date">${schedule.date || ''} ${schedule.time ? '(' + schedule.time + ')' : ''}</div><div class="schedule-time-venue">${schedule.venue || ''} ${schedule.note ? '- ' + schedule.note : ''}</div><div class="schedule-opponent">VS ${schedule.opponent || ''}</div>`;
                    fragment.appendChild(item);
                });
                const firstSchedule = schedules[0];
                const venueInfo = document.querySelector('.venue-info');
                venueInfo.innerHTML = `<div class="venue-name">${firstSchedule.venue || 'ë¯¸ì •'}</div><div class="venue-address">ğŸ“ ${firstSchedule.address || 'ì£¼ì†Œ ë¯¸ì •'}</div><div class="venue-phone">ğŸ“ ${firstSchedule.note || ''}</div>`;
                CONFIG.VENUE = { name: firstSchedule.venue || 'ë¯¸ì •', address: firstSchedule.address || 'ì£¼ì†Œ ë¯¸ì •', info: firstSchedule.note || '' };
                if (firstSchedule.address) { mapInitialized = false; loadKakaoMap(); }
            }
            scheduleContainer.innerHTML = '';
            scheduleContainer.appendChild(fragment);
        }

        async function loadData() {
            // 1. í•¨ìˆ˜ ì‹œì‘ ì‹œ ë°ì´í„° ì´ˆê¸°í™”
            matches = [];
            playerStats = {};
            regionalStats = [];

            try {
                showStatusMessage(`${currentSeason} ì‹œì¦Œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...`, 'loading');
                if (currentAbortController) currentAbortController.abort();
                currentAbortController = new AbortController();

                let data, dataSource = 'JSON íŒŒì¼';
                if (seasonDataCache.has(currentSeason)) {
                    data = seasonDataCache.get(currentSeason);
                    dataSource = 'ìºì‹œ';
                } else {
                    if (currentSeason === '2025') {
                        try {
                            data = await loadFromGoogleSheets(currentSeason);
                            dataSource = 'êµ¬ê¸€ ì‹œíŠ¸';
                        } catch (gsError) {
                            console.warn('êµ¬ê¸€ ì‹œíŠ¸ ë¡œë”© ì‹¤íŒ¨, JSON íŒŒì¼ë¡œ ëŒ€ì²´:', gsError.message);
                            const response = await fetch(`${currentSeason}_data.json`, { signal: currentAbortController.signal, headers: { 'Cache-Control': 'no-cache' } });
                            if (!response.ok) throw new Error(`HTTP ${response.status}: íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                            const rawData = await response.json();
                            data = validateSeasonData(rawData);
                            dataSource = 'JSON íŒŒì¼ (ëŒ€ì²´)';
                        }
                    } else {
                        const response = await fetch(`${currentSeason}_data.json`, { signal: currentAbortController.signal, headers: { 'Cache-Control': 'no-cache' } });
                        if (!response.ok) throw new Error(`HTTP ${response.status}: íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                        const rawData = await response.json();
                        data = validateSeasonData(rawData);
                    }
                    seasonDataCache.set(currentSeason, data);
                }

                // 2. ë°ì´í„° í• ë‹¹ í›„ ì¦‰ì‹œ í†µê³„ ì¹´ë“œ ì—…ë°ì´íŠ¸
                matches = data.matches || [];
                playerStats = data.players || {};
                regionalStats = data.regional || [];
                updateStats(); // ê°€ì¥ ë¨¼ì € í˜¸ì¶œ

                updateTable(playerStats, matches, 'playersTableBody', 'players');
                updateTable(matches, [], 'matchesTableBody', 'matches');
                updateSchedule(data.schedules || []);

                showStatusMessage(`${dataSource}ì—ì„œ ë°ì´í„° ë¡œë“œ ì™„ë£Œ`, 'success');
                setTimeout(hideStatusMessage, 2000);

            } catch (error) {
                if (error.name !== 'AbortError') {
                    let errorMessage = `${currentSeason} ì‹œì¦Œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`;
                    if (error.message.includes('404')) errorMessage += ' (íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤)';
                    else if (error.message.includes('Failed to fetch')) errorMessage += ' (ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”)';
                    showStatusMessage(errorMessage, 'error');
                    console.error(`${currentSeason} ì‹œì¦Œ ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:`, error);
                }
                // 3. ì—ëŸ¬ ë°œìƒ ì‹œì—ë„ í†µê³„ ì¹´ë“œ ì—…ë°ì´íŠ¸ (ë°ì´í„°ëŠ” ì´ë¯¸ ë¹ˆ ìƒíƒœ)
                updateStats();
                updateTable(playerStats, matches, 'playersTableBody', 'players');
                updateTable(matches, [], 'matchesTableBody', 'matches');
                updateSchedule([]);
            }
        }

        function filterPlayers(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => { btn.classList.toggle('active', btn.dataset.filter === filter); });
            if (isAllTimeView) {
                loadAllTimeSeasonsParallel().then(({ stats: allTimeStats }) => { updateAllTimeTable(allTimeStats, filter); });
            } else {
                updateTable(playerStats, matches, 'playersTableBody', 'players');
            }
        }

        function onSeasonSelectClick() {
            if (isAllTimeView) { setTimeout(() => { changeSeason(); }, 10); }
        }

        async function changeSeason() {
            const seasonSelect = document.getElementById('seasonSelect');
            const newSeason = seasonSelect.value;
            if (isAllTimeView || currentSeason !== newSeason) {
                if (isAllTimeView) { isAllTimeView = false; updateButtonStates(); document.getElementById('mainContent').style.display = 'grid'; document.getElementById('allTimeContent').style.display = 'none'; }
                currentSeason = newSeason;
                await loadData();
            }
        }

        function loadKakaoMap() {
            if (mapScriptLoaded) { initializeMap(); return; }
            const script = document.createElement('script');
            script.src = `https://dapi.kakao.com/v2/maps/sdk.js?appkey=${CONFIG.KAKAO_MAP_API_KEY}&autoload=false&libraries=services`;
            script.onload = function () { mapScriptLoaded = true; initializeMap(); };
            script.onerror = function () { console.error('ì¹´ì¹´ì˜¤ë§µ API ë¡œë“œ ì‹¤íŒ¨'); document.getElementById('map-placeholder').innerHTML = `<div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;color:#666;"><div>ğŸ—ºï¸</div><div style="margin-top:10px;">${CONFIG.VENUE.name}</div><div style="font-size:12px;margin-top:5px;">ì§€ë„ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div></div>`; };
            document.head.appendChild(script);
        }

        function initializeMap() {
            kakao.maps.load(function () {
                const mapContainer = document.getElementById('map-placeholder');
                mapContainer.innerHTML = '<div id="map" style="width:100%;height:300px;border-radius:8px;border:2px solid #1e40af;"></div>';
                const defaultCenter = new kakao.maps.LatLng(37.4656, 127.0347);
                const map = new kakao.maps.Map(document.getElementById('map'), { center: defaultCenter, level: 3 });
                const geocoder = new kakao.maps.services.Geocoder();
                const searchAddress = CONFIG.VENUE.address || 'ê²½ê¸° í•˜ë‚¨ì‹œ ê°ì´ë™ 465';
                geocoder.addressSearch(searchAddress, function (result, status) {
                    if (status === kakao.maps.services.Status.OK) {
                        const coords = new kakao.maps.LatLng(result[0].y, result[0].x); map.setCenter(coords);
                        const marker = new kakao.maps.Marker({ map: map, position: coords });
                        const infowindow = new kakao.maps.InfoWindow({ content: `<div style="padding:5px;font-size:12px;text-align:center;">${CONFIG.VENUE.name || 'êµ¬ì¥'}</div>` });
                        infowindow.open(map, marker); mapInitialized = true;
                    } else {
                        console.warn('ì£¼ì†Œ ê²€ìƒ‰ ì‹¤íŒ¨:', searchAddress, status); map.setCenter(defaultCenter);
                        const marker = new kakao.maps.Marker({ map: map, position: defaultCenter });
                        const infowindow = new kakao.maps.InfoWindow({ content: `<div style="padding:5px;font-size:12px;text-align:center;">${CONFIG.VENUE.name || 'êµ¬ì¥'}</div>` });
                        infowindow.open(map, marker); mapInitialized = true;
                    }
                });
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            const mainContainer = document.querySelector('.container');
            mainContainer.addEventListener('click', function(e) {
                if (e.target.classList.contains('filter-btn')) {
                    const filter = e.target.dataset.filter;
                    if (e.target.closest('.regional-records-section')) {
                        filterRegional(filter);
                    } else {
                        filterPlayers(filter);
                    }
                }
            });
        });

        function initializeScheduleAndVenue() {
            updateSchedule([]);
        }

        window.addEventListener('beforeunload', function() {
            if (currentAbortController) { currentAbortController.abort(); }
        });

        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const seasonParam = urlParams.get('season');
            if (seasonParam && [...CONFIG.AVAILABLE_SEASONS, 'all-time'].includes(seasonParam)) {
                if (seasonParam === 'all-time') { toggleAllTimeView(); return; } else { currentSeason = seasonParam; document.getElementById('seasonSelect').value = seasonParam; }
            }
            updateButtonStates();
            initializeScheduleAndVenue();
            loadData();
            setTimeout(loadKakaoMap, 3000);
        });

        // Placeholder for functions not defined yet but used in HTML
        function toggleAllTimeView() { console.log("toggleAllTimeView not implemented yet."); }
        function loadAllTimeSeasonsParallel() { console.log("loadAllTimeSeasonsParallel not implemented yet."); return Promise.resolve({stats:{}, records:null, regional:[]}); }
        function updateAllTimeRankings(stats) { console.log("updateAllTimeRankings not implemented yet."); }
        function updateAllTimeTable(stats, filter) { console.log("updateAllTimeTable not implemented yet."); }
        function updateTeamRecords(records) { console.log("updateTeamRecords not implemented yet."); }
        function updateRegionalTable(data) { console.log("updateRegionalTable not implemented yet."); }
        function filterRegional(filter) { console.log("filterRegional not implemented yet."); }
    </script>
</body>
</html>
